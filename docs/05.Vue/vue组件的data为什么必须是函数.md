# Vue ç»„ä»¶ data ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯å‡½æ•°

::: tip æ•™ç§‘ä¹¦èˆ¬çš„è§£é‡Š(å®˜ç½‘åŸè¯)

å½“ä¸€ä¸ªç»„ä»¶è¢«å®šä¹‰ï¼Œdata å¿…é¡»å£°æ˜ä¸ºè¿”å›ä¸€ä¸ªåˆå§‹æ•°æ®å¯¹è±¡çš„å‡½æ•°ï¼Œå› ä¸ºç»„ä»¶å¯èƒ½è¢«ç”¨æ¥åˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚å¦‚æœ data ä»ç„¶æ˜¯ä¸€ä¸ªçº¯ç²¹çš„å¯¹è±¡ï¼Œåˆ™æ‰€æœ‰çš„å®ä¾‹å°†å…±äº«å¼•ç”¨åŒä¸€ä¸ªæ•°æ®å¯¹è±¡ï¼é€šè¿‡æä¾› data å‡½æ•°ï¼Œæ¯æ¬¡åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹åï¼Œæˆ‘ä»¬èƒ½å¤Ÿè°ƒç”¨ data å‡½æ•°ï¼Œä»è€Œè¿”å›åˆå§‹æ•°æ®çš„ä¸€ä¸ªå…¨æ–°å‰¯æœ¬æ•°æ®å¯¹è±¡

:::

ğŸ‘† æ³¨æ„ä¸è¦å›«å›µåæ£ï¼Œæ„Ÿå—ä¸‹ä¸‹é¢ 2 å¥è¯ï¼š

- æ˜¯`ç»„ä»¶`ä¸ºä»€ä¹ˆå¿…é¡»æ˜¯å‡½æ•°
- ç»„ä»¶å¯è¢«åˆ›å»ºå¤šä¸ªå®ä¾‹

> å¾ˆé•¿ä¸€æ®µæ—¶é—´æˆ‘éƒ½ç†è§£ä¸ºï¼š~~ä¸ºä»€ä¹ˆ vue çš„ data éœ€è¦å‡½æ•°è¿”å›~~ï¼Œé‚£æˆ‘ä»¬ç›´æ¥å¼•å…¥ JS ä½¿ç”¨çš„æ—¶å€™ï¼Œ`new Vue`ä¹Ÿæ²¡è§çš„ä¸€å®šè¦å‡½æ•°è¿”å›å•Šã€‚ç›´åˆ°ä»Šå¤©æ‰å‘ç°æ˜¯ç†è§£å°‘äº†å‡ ä¸ªå­—ï¼Œ**vue åˆ›å»ºçš„ç»„ä»¶çš„ data æ‰éœ€è¦å‡½æ•°è¿”å›**

ä¸æƒ³çœ‹åˆ†æçš„ç›´æ¥çœ‹è¿™é‡Œ

::: tip é—®é¢˜åˆ†ææ€»ç»“

`new Vue` å¯ä»¥ä¸ä½¿ç”¨å‡½æ•°è¿”å›çš„åŸå› åœ¨äºï¼Œæ¯æ¬¡`new`çš„æ—¶å€™ï¼Œä¼ å…¥çš„éƒ½æ˜¯æ–°çš„å¯¹è±¡ï¼ˆæ–°çš„å†…å­˜åœ°å€ï¼‰ã€‚æ‰€ä»¥ä¿®æ”¹å…¶ä¸­ä¸€ä¸ª vue å®ä¾‹å¹¶ä¸ä¼šå½±å“å…¶ä»–å®ä¾‹

å¯¹äºç»„ä»¶è€Œè¨€ï¼Œç»„ä»¶å®šä¹‰å¥½ä¹‹åæ˜¯æœ‰é»˜è®¤å€¼ **ï¼ˆæˆ‘ä»¬æŠŠä¸€ä¸ªç»„ä»¶å¼•å…¥åï¼Œä¿®æ”¹äº†éƒ¨åˆ†å€¼åã€‚å†æ¬¡å¼•å…¥ç›¸åŒçš„ç»„ä»¶æ—¶ï¼Œç¬¬äºŒæ¬¡å¼•å…¥çš„ç»„ä»¶åˆå§‹å€¼è¿˜æ˜¯ä¿æŒåŸæ¥è®¾ç½®çš„ï¼‰** æ‰€ä»¥åœ¨ç»„ä»¶æ³¨å†Œï¼ˆvue çš„ä¸€ä¸ªå†…éƒ¨æµç¨‹ï¼‰çš„æ—¶å€™ï¼Œvue ä¼šæŠŠè¿™ä¸ªç»„ä»¶**ä¼ å…¥çš„é…ç½®å­˜ä¸‹æ¥**ï¼Œå¤šæ¬¡ç”ŸæˆåŒä¸€ä¸ªç»„ä»¶çš„æ—¶å€™éƒ½ä¼š**ä»å­˜ä¸‹æ¥çš„é…ç½®ä¸­å–å€¼**ï¼Œç„¶åé€šè¿‡`new`åˆ›å»ºæ–°çš„ç»„ä»¶å®ä¾‹ã€‚å¯å¦‚æœè¿™æ—¶å€™ data ä¸ºå¯¹è±¡ **ï¼ˆå¼•ç”¨ç±»å‹çš„å†…å­˜åœ°å€æ˜¯ä¸€æ ·çš„ï¼‰** ï¼Œé‚£æ¯æ¬¡ç”Ÿæˆæ–°çš„ç»„ä»¶å®ä¾‹çš„ data éƒ½æŒ‡å‘äº†**åŒä¸€ä¸ªå†…å­˜åŒºåŸŸ**ï¼Œè¿™æ—¶å€™å…¶ä¸­ä¸€ä¸ªåŒç±»å‹ç»„ä»¶å€¼æ›´æ–°äº†ã€‚å…¶ä½™çš„éƒ½ä¼šè·Ÿç€ä¸€èµ·æ›´æ–°

è¦è§£å†³ä¸Šè¿°è¯´çš„ç»„ä»¶çš„é—®é¢˜ï¼Œå°±éœ€è¦ç”¨å‡½æ•°çš„å½¢å¼ï¼Œæ¯æ¬¡åˆ›å»ºç»„ä»¶éƒ½é€šè¿‡ function è¿”å›ä¸€ä¸ª**æ–°çš„å¯¹è±¡ï¼ˆå†…å­˜åœ°å€ä¸ä¸€æ ·çš„å¯¹è±¡ï¼‰**ã€‚è¿™æ ·ç»„ä»¶çš„ data æ‰æ˜¯è‡ªå·±å•ç‹¬çš„

:::

## è¦ç†è§£è¿™ä¸ªé—®é¢˜ï¼Œå¾—ä»åŸå‹è¯´èµ·

ä¸ç†Ÿçœ‹è¿™é‡Œ ğŸ‘‰ [åŸå‹å’ŒåŸå‹é“¾-åŸºç¡€,ä½†æ˜¯éå¸¸é‡è¦](../02.JavaScript/åŸå‹å’ŒåŸå‹é“¾.html)

### 3 ä¸ªæ —å­ ç†è§£ååœ¨çœ‹æºç 

**1. æ¡ˆä¾‹ 1ï¼š**

```js {2,7,8,9}
function Animal() {}
Animal.prototype.data = { name: 'å® ç‰©åº—', address: 'å¹¿å·' }
var dog = new Animal()
var cat = new Animal()
console.log(dog.data.address) // å¹¿å·
console.log(cat.data.address) // å¹¿å·
dog.data.address = 'ä¸œè'
console.log(cat.data.address) // ä¸œè
dog.data === cat.data // true
```

::: tip ç¬¬ä¸€ä¸ªå°ç»“è®º

dog å’Œ cat çš„åŸå‹éƒ½æ˜¯ Animalã€‚è‡ªç„¶ä¼šç»§æ‰¿åŸå‹çš„å±æ€§ã€‚ç»§æ‰¿è¿‡æ¥åï¼Œ`å› ä¸º data æ˜¯æ™®é€šå¯¹è±¡`ï¼Œå±äº`å¼•ç”¨æ•°æ®ç±»å‹`ï¼Œæ‰€ä»¥ dog å’Œ cat çš„ data å…¶å®éƒ½æŒ‡å‘åŒä¸€å—å†…å­˜åœ°å€

å°±è¿ä¸¥æ ¼è¿ç®—ç¬¦åˆ¤æ–­éƒ½æ˜¯ç›¸ç­‰çš„ï¼Œ**è¯´æ˜ä»–ä»¬å€¼ç›¸ç­‰ï¼Œå†…å­˜åœ°å€ä¹Ÿç›¸åŒï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªå°†ä¼šå½±å“å¦å¤–ä¸€ä¸ª**
:::

**2. æ¡ˆä¾‹ 2ï¼š**

```js {2,5,11,12,13,14}
function Animal() {
  this.data = this.data()
}
Animal.prototype.data = function() {
  return { name: 'å® ç‰©åº—', address: 'å¹¿å·' }
}
var dog = new Animal()
var cat = new Animal()
console.log(dog.data.address) // å¹¿å·
console.log(cat.data.address) // å¹¿å·
dog.data.address = 'ä¸œè'
console.log(cat.data.address) // å¹¿å·
console.log(dog.data.address) // ä¸œè
dog.data === cat.data // false
```

**ç¨å¾®è§£é‡Šä¸‹**ï¼šä¸ºä»€ä¹ˆç¬¬äºŒè¡Œ:`this.data = this.data()`

> æˆ‘ä»¬åœ¨æ‰§è¡Œ new çš„è¿‡ç¨‹ä¸­ï¼ŒAnimal å…¶å®å……å½“äº†`constructor`ã€‚è¯¦æƒ…å¯ä»¥çœ‹ [new ä¸€ä¸ªå¯¹è±¡å‘ç”Ÿäº†ä»€ä¹ˆ](../02.JavaScript/newä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™å‘ç”Ÿäº†ä»€ä¹ˆ.html)ã€‚è¿™æ—¶å€™ `this.data` è¿˜æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿˜æ²¡æ‰§è¡Œçš„å‡½æ•°ï¼Œæ‰€ä»¥è°ƒç”¨ä¸€ä¸‹ this.data()ã€‚è®©å‡½æ•°è¿”å›ä¸€ä¸ªå€¼ã€‚ç„¶åé‡æ–°èµ‹å€¼ç»™ `this.data`

::: tip ç»“è®º 2
ç”¨äº† function åï¼Œdata éƒ½è¢«é”å®šåœ¨å½“å‰ function çš„ä½œç”¨åŸŸä¸­ï¼Œç„¶åè¢«è¿”å›å‡ºå»ï¼Œ**ç›¸å½“äºåˆ›å»ºäº†å¦å¤–ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥å¤šä¸ªå®ä¾‹ä¹‹é—´ä¸ä¼šç›¸äº’å½±å“**
:::

**3. æ¡ˆä¾‹ 3**

```js {2,4,5,10}
function Animal({ data }) {
  this.data = data
}
var dog = new Animal({ data: { name: 'å® ç‰©åº—', address: 'å¹¿å·' } })
var cat = new Animal({ data: { name: 'å® ç‰©åº—', address: 'å¹¿å·' } })

console.log(dog.data.address) // å¹¿å·
console.log(cat.data.address) // å¹¿å·

dog.data === cat.data // false
```

::: tip ç»“è®º 3

æ³¨æ„è¿™é‡Œçš„å˜é‡å£°æ˜æ–¹å¼ï¼Œæ˜¯ç›´æ¥æ”¾åœ¨äº†æ„é€ å‡½æ•°ä¸­ï¼Œå¹¶ä¸æ˜¯é€šè¿‡åŸå‹é“¾æ¥æŸ¥æ‰¾çš„ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆ`new Vue`çš„æ—¶å€™ data å¯ä»¥ä¸ºéå‡½æ•°ï¼Œ**åœ¨æ„é€ å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œdata å°±å·²ç»ç›¸äº’éš”ç¦»**

:::

## ä½¿ç”¨ debuggerï¼Œçœ‹ä¸‹ new vue å‘ç”Ÿäº†ä»€ä¹ˆ

**å¤šå›¾é¢„è­¦ï¼ï¼** new Vue å‘ç”Ÿäº†ä»€ä¹ˆ!!

å…³äº `new Vue`ï¼Œå¯ä»¥çœ‹`æ¡ˆä¾‹ 3`ã€‚åœ¨ new çš„è¿‡ç¨‹ä¸­ï¼Œå°±å·²ç»ä¼ å…¥å‚æ•°èµ‹å€¼

å¼€å§‹ debugger

```html
<!-- å¼•å…¥vue -->
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
```

```js
debugger
// åœ¨ new Vueä¹‹å‰ï¼Œè¿›å…¥debuggeræ¨¡å¼
var app = new Vue({
  el: '#app',
  data: { message: 'Hello Vue!' }
})
```

### 1. èµ°åˆ°äº†åˆå§‹åŒ– vue çš„æ­¥éª¤

![](https://gitee.com/Jioho/img/raw/master/knowledge/20200623202450.png)

### 2. æ¥åˆ° init æ–¹æ³•å†…éƒ¨

- 4994 è¡Œ æˆ‘ä»¬å¸¸è§çš„ vm å¯¹è±¡ã€‚å…¶å®å°±æ˜¯ vue çš„ this å¯¹è±¡ã€‚(å›¾ç‰‡æˆªçš„ä¸å¤Ÿé•¿ï¼Œå¾€ä¸Šä¸€ç‚¹èƒ½çœ‹åˆ° vm = this)
- 4998 æˆ‘ä»¬å¸¸è¯´çš„ç”Ÿå‘½å‘¨æœŸç¬¬ä¸€æ­¥ `beforeCreate`
- 5000 è¿™æ˜¯æˆ‘ä»¬ä»Šå¤©è¦æ·±ç©¶çš„å‡½æ•°ï¼š`initState` åˆå§‹åŒ– data å¯¹è±¡çš„
- 5002 ç”Ÿå‘½å‘¨æœŸç¬¬äºŒæ­¥ `create`

> éªŒè¯äº† vue ç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼šbeforeCreate è¿˜ä¸èƒ½æ‹¿åˆ° this.dataã€‚éœ€è¦åœ¨ create çš„æ—¶å€™æ‰èƒ½æ‹¿åˆ°

![](https://gitee.com/Jioho/img/raw/master/knowledge/20200623202707.png)

### 3. æ¥åˆ° initState æ–¹æ³•

- å¯ä»¥çœ‹åˆ°åˆå§‹åŒ–`props`ã€åˆå§‹åŒ–`methods`ã€‚ç„¶åæ‰åˆ°åˆå§‹åŒ– `data`ã€‚å¦‚æœæ²¡æœ‰ data è¿˜ä¼šç»™ä¸ªé»˜è®¤å€¼`{}`
- åˆå§‹åŒ– `data` åå¼€å§‹å¤„ç† `computed`ã€‚ç„¶åæŒ‚è½½ `watch`
- ä¸»é¢˜æ˜¯ç ”ç©¶ `data` ã€‚ç»§ç»­è¿›å…¥åˆ° `initData` å‡½æ•°é‡Œé¢

![](https://gitee.com/Jioho/img/raw/master/knowledge/20200623203322.png)

### 4. initData æ–¹æ³•

```js
data = vm._data = typeof data === 'function' ? getData(data, vm) : data || {}
```

- å¯ä»¥çœ‹åˆ°æ˜¯æœ‰åˆ¤æ–­ï¼Œå¦‚æœä¼ å…¥çš„æ˜¯å‡½æ•°ï¼Œå°±è°ƒç”¨è¯¥å‡½æ•°(`getDataæ–¹æ³•é‡Œé¢å°±æ˜¯è°ƒç”¨å‡½æ•°è¿”å›å¯¹è±¡çš„`)ã€‚å¦‚æœä¸æ˜¯å‡½æ•°å°±é»˜è®¤æ‹¿ dataï¼Œå¦åˆ™è¿˜æ˜¯ä¸ªé»˜è®¤å€¼ã€‚
- æ¥ä¸‹æ¥çš„æ­¥éª¤å°±æ˜¯å¼€å§‹åšä¸€äº›ä»£ç†ï¼Œæ•°æ®æŒŸæŒçš„ç›‘å¬`proxy`ã€`observer` ä¹‹ç±»çš„ ~~ä¸åœ¨æˆ‘ä»¬ data è®¨è®ºèŒƒç•´äº†~~ã€‚ä¸‹æ¬¡åœ¨åˆ†æ

![](https://gitee.com/Jioho/img/raw/master/knowledge/20200623203657.png)

### å°ç»“

::: tip new vue å°ç»“

new Vue çš„è¿‡ç¨‹å’Œæ¡ˆä¾‹ 3 æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œåªæ˜¯å•çº¯çš„ä¼ å…¥å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ new çš„ç‰¹æ€§ï¼Œç»™ `vm._data` å¯¹è±¡èµ‹å€¼ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ä¸ºå½“å‰çš„ vue å®ä¾‹çš„ data èµ‹å€¼ï¼Œç”±äº new çš„ç‰¹æ€§åœ¨ï¼Œæ‰€ä»¥ data ä¸å¼ºæ±‚å‡½æ•°è¿”å›ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å‡½æ•°è¿”å›

:::

## new Vue çš„æºç ç®€å•çš„çœ‹ä¸‹ã€‚é‚£ç»§ç»­çœ‹ä»Šå¤©ä¸»è§’ `components` çš„å®ç°

`components` ä½œä¸ºä¸€ä¸ªç»„ä»¶ç±»å‹ï¼Œåªæ˜¯ä¸€ä¸ªç®€å•çš„å·¥å‚æ¨¡å¼ï¼ˆä¸€å¼€å§‹çš„ç»„ä»¶å‚æ•°éƒ½æ˜¯å®šå¥½çš„ï¼Œéœ€è¦å°±åˆ›å»ºä¸€ä¸ªæ–°çš„ç»„ä»¶ï¼Œç®€ç§°å·¥å‚æ¨¡å¼ï¼‰ï¼Œåˆ›å»ºå¾ˆå¤šçš„ç»„ä»¶å®ä¾‹ã€‚å°±åƒ`æ¡ˆä¾‹ 1` ä¸€æ ·

è¿˜æ˜¯å…ˆå†™ä¸€ä¸ª debugger è¿›å…¥æºç 

**æ—¥å¸¸å¤šå›¾é¢„è­¦ï¼ï¼**

```html
<!-- å¼•å…¥vue -->
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
```

```js
// åœ¨ new Vueä¹‹å‰ï¼Œè¿›å…¥debuggeræ¨¡å¼
debugger
// å®šä¹‰ä¸€ä¸ªåä¸º button-counter çš„æ–°ç»„ä»¶
Vue.component('button-counter', {
  data: function() {
    return {
      count: 0
    }
  },
  template: '<button v-on:click="count++">You clicked me {{ count }} times.</button>'
})
```

### 1. è¿›å…¥åˆ°äº† initAssetRegisters åˆå§‹åŒ–ç™»è®°æ³¨å†Œï¼ˆç»„ä»¶æ³¨å†Œï¼‰

- 5225 è¡Œã€‚åˆ¤æ–­è¦æ³¨å†Œçš„æ˜¯ä¸€ä¸ª `component` ç»„ä»¶
- 5232 è¡Œã€‚åˆ¤æ–­è¦æ³¨å†Œçš„æ˜¯ `directive` æŒ‡ä»¤ã€‚æ³¨å†Œäº‹ä»¶éƒ½çš„ç¡®åœ¨ `initAssetRegisters`ä¸­ã€‚
- 5226 è¡Œ `validateComponentName` éªŒè¯ç»„ä»¶åç§°æ˜¯å¦è¢«å ç”¨
- 5229 æ˜¯åˆ¤æ–­ç»„ä»¶æ˜¯å¦æœ‰å®šä¹‰çš„åç§°ï¼Œæ²¡æœ‰å°±ç”¨è‡ªå·±ç»„ä»¶çš„æ ‡ç­¾ã€‚è¿™æ˜¯ä¸ºäº† ä¸Šä¸€æ­¥ï¼ŒéªŒè¯ç»„ä»¶æ˜¯å¦å·²ç»ç”Ÿæˆçš„ã€‚
- 5230 `this.options._base.extend(definition)` æœ‰è¿™ä¹ˆä¸€æ®µä»£ç ï¼Œä¸‹ä¸€æ­¥å°±åˆ°è¿™é‡Œé¢çœ‹çœ‹

![](https://gitee.com/Jioho/img/raw/master/knowledge/20200623204932.png)

### 2. extend å‡½æ•°ä¸­

- `this.options._base` å…¶å®å°±æ˜¯ä¸‹å›¾ä¸­çš„ Vueã€‚è°ƒç”¨ `Vue.extend`
- ç•™æ„çœ‹ 5146-5148 è¡Œã€‚**æˆ‘åœ¨ 5147 æ‰“äº†æ–­ç‚¹ã€‚åç»­çš„æ­¥éª¤ä¼šå›åˆ°è¿™é‡Œ**
- è¿™ä¸€è·¯æ‰§è¡Œä¸‹æ¥ã€‚ç”Ÿæˆäº†ä¸€ä¸ª`Sub`å¯¹è±¡ã€‚
- 5149-5155 è¡Œã€‚å°±æ˜¯å‡†å¤‡ä¸€ä¸ª `new` çš„è¿‡ç¨‹ã€‚

```js
Sub.prototype = Object.create(Super.prototype) // æ„é€ å™¨åŸå‹
Sub.prototype.constructor = Sub // æ„é€ å‡½æ•°ç­‰äºSubæ–¹æ³•ã€‚åœ¨newçš„æ—¶å€™å°±ä¼šæ‰§è¡ŒSubé‡Œé¢çš„å†…å®¹
Sub.cid = cid++
Sub.options = mergeOptions(Super.options, extendOptions) // åˆå¹¶å‚æ•°ç­‰
```

- 5192 è¡Œã€‚æŠŠ `Sub` å¯¹è±¡ return äº†å›å»ã€‚é‚£å°±æ˜¯å›åˆ°äº† `initAssetRegisters` å‡½æ•°é‚£è¾¹å»äº†
- å›å»åï¼ŒæŠŠ `Sub` èµ‹å€¼ç»™äº†`definition` å¯¹è±¡ï¼ˆç¬¬ä¸€æ­¥çš„ 5230 è¡Œï¼‰
- æ¥ç€ definition ä¹Ÿè¢«è¿”å›å‡ºå»äº†ã€‚å…¶ä¸­è¿™ä¸€ä¸ªè¿”å›è¢«ä¸€ä¸ªå‡½æ•°åŒ…è£¹ç€ã€‚å‡½æ•°è¢«èµ‹å€¼ä¸º `Vue[type]`(ç¬¬ä¸€æ­¥çš„ 5217 è¡Œæ¥æ”¶äº†)è¿™æ—¶å€™ type æ˜¯`component`ã€‚ç›¸å½“äº è°ƒç”¨ `Vue.component` çš„è¯ï¼Œè¿”å›å€¼å°±æ˜¯`Sub`
- **é‡ç‚¹ï¼š** 5152 è¡Œå’Œ 5154 è¡Œä¸­ã€‚Sub.options åˆå¹¶äº† 2 ä¸ªå¯¹è±¡ï¼Œåˆ†åˆ«æ˜¯ `Super.options(åº”è¯¥æ˜¯çˆ¶ç»„ä»¶çš„ä¸€äº›å‚æ•°äº†)`ã€‚ç¬¬äºŒä¸ªå°±æ˜¯åˆå¹¶äº†è‡ªå·±çš„å‚æ•°ï¼Œ**å…¶ä¸­ data å°±åœ¨ 5154 è¡Œä¸­**ã€‚åé¢çš„æ­¥éª¤è¿˜ä¼šè¯´è¿™ä¸ª `options`

æœ‰ç‚¹é•¿ï¼Œåˆ†å¼€ 2 å¼ å›¾

![](https://gitee.com/Jioho/img/raw/master/knowledge/20200623205840.png)
![](https://gitee.com/Jioho/img/raw/master/knowledge/20200623205901.png)

### 3. æƒ³åŠæ³•è¿›å…¥ init æ–¹æ³•çœ‹çœ‹

å› ä¸ºåœ¨æ­¥éª¤ 2 ä¸­æˆ‘ä»¬ç•™äº†ä¸ªæ–­ç‚¹ï¼Œè€Œä¸€å¼€å§‹åˆ›å»ºç»„ä»¶çš„æ–¹å¼æ˜¯å…¨å±€åˆ›å»ºçš„ã€‚å¯èƒ½å¾ˆå¤šæ­¥éª¤æ²¡æœ‰çœ‹åˆ°ï¼ŒæŠŠä»£ç æ”¹ä¸€æ”¹ï¼Œæ”¹æˆå±€éƒ¨ç»„ä»¶ï¼Œåœ¨ debugger ä¸€ä¸‹

ä»£ç æ”¹æˆè¿™æ ·å­ï¼Œå› ä¸ºä¹‹å‰ç•™æœ‰æ–­ç‚¹ï¼Œæ‰€ä»¥å°±æ— é¡» debugger äº†ï¼Œåˆ·æ–°å³å¯ç›´æ¥åˆ°æˆ‘ä»¬å®šå¥½çš„æ–­ç‚¹é‡Œé¢å»ï¼š

```js
var ComponentA = {
  template: '<button v-on:click="count++">You clicked me {{ count }} times.</button>',
  data() {
    return { count: 0 }
  }
}
var app = new Vue({
  el: '#app',
  components: {
    'component-a': ComponentA
  }
})
```

èƒ½å›åˆ° `Sub` é‡Œé¢ã€‚è¯´æ˜æˆ‘ä»¬ä¹‹å‰æ‘¸ç´¢çš„æ­¥éª¤è¢«è°ƒç”¨äº†ã€‚Sub æ–¹æ³•è¢«è°ƒç”¨ï¼Œæ‰ä¼šæ‰§è¡Œåˆ°`init`ã€‚é‚£æˆ‘ä»¬åœ¨ initã€‚è¿”å›ä¸Šä¸€æ­¥ï¼Œçœ‹ä¸‹æ˜¯è°è°ƒç”¨çš„ã€‚

![](https://gitee.com/Jioho/img/raw/master/knowledge/20200623212401.png)

çœ‹æ¥è¿™ä¸€æ­¥å°±æ˜¯å¼€å§‹ new ä¸€ä¸ªæ–°çš„ç»„ä»¶ã€‚æ‰€ä»¥è§¦å‘åˆ°äº† init æ–¹æ³•

è¿™æ¬¡è¿›æ¥æ€»ç®—çœ‹åˆ°æœ‰ä¸‹ä¸€æ­¥çš„å‡½æ•°
![](https://gitee.com/Jioho/img/raw/master/knowledge/20200623211712.png)

### 4. è¿›å…¥ç»„ä»¶çš„ init æ–¹æ³•ä¸­

- ç‰¹åˆ«ç†Ÿæ‚‰çš„æ„Ÿè§‰ã€‚æ²¡é”™ï¼å°±æ˜¯ `new Vue` é‚£ä¸ªè¿‡ç¨‹ï¼æ¯•ç«Ÿç»„ä»¶ä¹Ÿæœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸï¼Œå‚æ•°ï¼Œå­ç»„ä»¶ï¼Œæ‰€ä»¥åˆå›åˆ°äº†è¿™é‡Œ
- é‚£ `initState` - `initData` çš„è¿‡ç¨‹æˆ‘å°±ä¸é‡å¤ã€‚ä¸æ¸…æ¥šçš„å¯ä»¥å†çœ‹ä¸Šé¢ `new Vue`çš„è¿‡ç¨‹ã€‚

![](https://gitee.com/Jioho/img/raw/master/knowledge/20200623211820.png)

### 5. ç»„ä»¶çš„ data åœ¨ `initData` ä¸­çš„ä½œç”¨

è¿™é‡Œå¼€å§‹ç»•äº†ã€‚æ€è·¯è¦æ¸…æ™°

- å›æƒ³æ­¥éª¤ 2 extend å‡½æ•°ä¸­ 5152 è¡Œã€‚å’Œ 5154 è¡Œã€‚æ˜¯ä¸æ˜¯å­˜å‚¨äº†ç»„ä»¶çš„ `options`ã€‚

- é‚£åœ¨ä¸‹å›¾çš„ `4700` è¡Œä¸­ã€‚vm å°±æ˜¯å½“å‰çš„ç»„ä»¶ã€‚ä»–çš„`options`å°±æ˜¯æ¥è‡ªç»„ä»¶æ³¨å†Œæ—¶ï¼Œç”Ÿæˆçš„`Sub`å¯¹è±¡

![](https://gitee.com/Jioho/img/raw/master/knowledge/20200623213443.png)

### 6. è¿™æ—¶å€™æŠ½è±¡å‡ºæ¥ä¸€äº›ä»£ç 

- Sub.options æ˜¯ç»„ä»¶æ³¨å†Œçš„æ—¶å€™å°±å¼€å§‹æœ‰å€¼äº†ã€‚æ‰€ä»¥æˆ‘ä»¬ä¹Ÿç»™ä¸ªé»˜è®¤å€¼æ¼”ç¤º
- Sub.prototype.init ä¼°è®¡æ˜¯åæœŸèµ‹å€¼ï¼Œèµ‹å€¼ä¸ºåˆ›å»º vue çš„ç”Ÿå‘½å‘¨æœŸçš„å‡½æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬ä¹Ÿç»™ä»–æ¥ä¸€ä¸ªç®€åŒ–ç‰ˆçš„å‡½æ•°ï¼Œåªæ¨¡æ‹Ÿèµ‹å€¼ this.data çš„è¿‡ç¨‹ï¼Œçœ‹ä¸€ä¸‹æ•ˆæœ

```js
var Sub = function() {
  this.init()
}
Sub.prototype = {}
Sub.prototype.constructor = Sub
Sub.prototype.init = function() {
  this.data = typeof Sub.options.data === 'function' ? Sub.options.data() : Sub.options.data
}
Sub.options = {} // ç­‰ä¸‹ä¼šç»™é»˜è®¤å€¼
```

### 7. æ ¹æ®æŠ½è±¡å‡ºæ¥çš„ä»£ç ï¼Œæ¨¡æ‹Ÿ new å‡ ä¸ªç»„ä»¶

**ç¬¬ä¸€æ¬¡å°è¯•ç”¨çš„æ˜¯ data å¯¹è±¡å½¢å¼ï¼š**

::: tip åŸç†å’Œæœ€ä¸Šé¢çš„`æ¡ˆä¾‹ 1` ä¸€æ ·

å› ä¸º data æ˜¯å¼•ç”¨ç±»å‹ã€‚å¹¶ä¸”ä¸€å¼€å§‹ Sub.options å°±æ˜¯æœ‰å€¼çš„ï¼Œåœ¨åˆ›å»ºæ–°ç»„ä»¶çš„æ—¶å€™æ‹¿çš„éƒ½æ˜¯åŒä¸€ä¸ªåœ°æ–¹çš„å€¼

:::

```js
// ä¸Šé¢ä¹Ÿè¯´äº†ã€‚å…ˆç»™sub.optionsæ¥ä¸ªé»˜è®¤å€¼ã€‚æ¨¡æ‹Ÿä¼ å…¥çš„å‚æ•°
Sub.options = {
  template: '<button v-on:click="count++">You clicked me {{ count }} times.</button>',
  data: {
    count: 0
  }
}

// ç»“åˆæ­¥éª¤6çš„ä»£ç ã€‚åˆ›å»º3ä¸ªç»„ä»¶
var component1 = new Sub()
var component2 = new Sub()
var component3 = new Sub()

console.log(component1) // {data:{count:0}}
console.log(component2) // {data:{count:0}}
console.log(component2) // {data:{count:0}}

// çœ‹ç€å¥½åƒæ²¡å•¥é—®é¢˜ï¼Ÿæˆ‘ä»¬æ¥ä¿®æ”¹ä¸€ä¸ªç»„ä»¶çš„å€¼
component1.data.count = 1

// ä¼ è¯´ä¸­çš„ç»„ä»¶ä¸­å€¼ä¼šç›¸äº’å½±å“æƒ…å†µå‡ºç°äº†
console.log(component1) // {data:{count:1}}
console.log(component2) // {data:{count:1}}
console.log(component3) // {data:{count:1}}
```

**å¦‚æœæ”¹æˆå‡½æ•°çš„å½¢å¼å‘¢ï¼Ÿ**

::: tip åŸç†å’Œ`æ¡ˆä¾‹ 2` ä¸€æ ·ã€‚

è™½ç„¶è¿™æ—¶å€™ Sub.options æ‹¿åˆ°ä¹Ÿæ˜¯åŒä¸€ä¸ªåœ°æ–¹çš„å€¼ã€‚å¯æ˜¯ Sub.options.data å·²ç»æ˜¯å‡½æ•°ç±»å‹ï¼Œè€Œä¸æ˜¯å¼•ç”¨ç±»å‹ã€‚å‡½æ•°æ‰§è¡Œåï¼Œè¿”å›çš„å€¼éƒ½æ˜¯ä¸ç”¨å †å†…å­˜çš„åœ°å€ï¼Œæ‰€ä»¥ä¿®æ”¹æŸä¸€ä¸ª`Subå®ä¾‹ï¼ˆç»„ä»¶çš„å€¼ï¼‰`å…¶ä½™çš„ç»„ä»¶éƒ½ä¸ä¼šå—åˆ°å½±å“

:::

```js
// ä¸Šé¢ä¹Ÿè¯´äº†ã€‚å…ˆç»™sub.optionsæ¥ä¸ªé»˜è®¤å€¼ã€‚æ¨¡æ‹Ÿä¼ å…¥çš„å‚æ•°
Sub.options = {
  template: '<button v-on:click="count++">You clicked me {{ count }} times.</button>',
  data() {
    return {
      count: 0
    }
  }
}

// ç»“åˆæ­¥éª¤6çš„ä»£ç ã€‚åˆ›å»º3ä¸ªç»„ä»¶
var component1 = new Sub()
var component2 = new Sub()
var component3 = new Sub()

console.log(component1) // {data:{count:0}}
console.log(component2) // {data:{count:0}}
console.log(component3) // {data:{count:0}}

component1.data.count = 2
// ç°åœ¨å°±ä¸ä¼šäº’ç›¸å½±å“äº†
console.log(component1) // {data:{count:2}}
console.log(component2) // {data:{count:0}}
console.log(component2) // {data:{count:0}}
```

### 8. æœ€åæ€»ç»“ä¸€ä¸‹ demo

å¯ä»¥è‡ªå·±è¯•ç€æ”¹ä¸€æ”¹ã€‚è·‘ä¸€è·‘

```js
var Sub = function() {
  this.init()
}
Sub.prototype = {}
Sub.prototype.constructor = Sub
Sub.prototype.init = function() {
  this.data = typeof Sub.options.data === 'function' ? Sub.options.data() : Sub.options.data
}
Sub.options = {
  template: '<button v-on:click="count++">You clicked me {{ count }} times.</button>',
  data() {
    return {
      count: 0
    }
  }
}

// ç»“åˆæ­¥éª¤6çš„ä»£ç ã€‚åˆ›å»º3ä¸ªç»„ä»¶
var component1 = new Sub()
var component2 = new Sub()
var component3 = new Sub()

console.log(component1) // {data:{count:0}}
console.log(component2) // {data:{count:0}}
console.log(component3) // {data:{count:0}}

component1.data.count = 2
// ç°åœ¨å°±ä¸ä¼šäº’ç›¸å½±å“äº†
console.log(component1) // {data:{count:2}}
console.log(component2) // {data:{count:0}}
console.log(component2) // {data:{count:0}}
```
